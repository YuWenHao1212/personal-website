---
interface Props {
  id: string;
  source: 'reddit' | 'hackernews' | 'producthunt';
  category: string;
  title: string;
  url: string;
  score: number;
  comments: number;
  selftext?: string;
  subreddit?: string;
  fbPotential: string;
  blogPotential: string;
  engagementScore: number;
}

const {
  id,
  source,
  category,
  title,
  url,
  score,
  comments,
  selftext,
  subreddit,
  fbPotential,
  blogPotential,
  engagementScore,
} = Astro.props;

// Source display config
const sourceConfig: Record<string, { label: string; color: string }> = {
  reddit: { label: 'Reddit', color: 'bg-orange-100 text-orange-700' },
  hackernews: { label: 'HN', color: 'bg-amber-100 text-amber-700' },
  producthunt: { label: 'PH', color: 'bg-red-100 text-red-700' },
};

const sourceInfo = sourceConfig[source] || sourceConfig.reddit;

// Potential badge colors
const potentialColors: Record<string, string> = {
  High: 'bg-green-100 text-green-700',
  Medium: 'bg-yellow-100 text-yellow-700',
  Low: 'bg-gray-100 text-gray-500',
};

// Truncate selftext for display
const truncatedText = selftext && selftext.length > 150
  ? selftext.slice(0, 150) + '...'
  : selftext;

// Build source label
const sourceLabel = source === 'reddit' && subreddit
  ? `r/${subreddit}`
  : sourceInfo.label;

---

<div
  class="item-card bg-white border border-cream-200 rounded-xl p-5 hover:shadow-md hover:border-accent/30 transition-all"
  data-source={source}
  data-category={category}
  data-score={engagementScore}
  data-id={id}
  data-title={title}
  data-url={url}
  data-selftext={selftext || ''}
  data-subreddit={subreddit || ''}
  data-points={score}
  data-comments={comments}
  data-fb-potential={fbPotential}
  data-blog-potential={blogPotential}
>
  <!-- Header with checkbox -->
  <div class="flex items-start justify-between gap-3 mb-3">
    <div class="flex items-center gap-2 flex-wrap">
      <!-- Batch select checkbox -->
      <input
        type="checkbox"
        class="card-checkbox w-4 h-4 rounded border-cream-300 text-accent focus:ring-accent/20 cursor-pointer"
        title="Select for batch action"
      />
      {engagementScore >= 4 && (
        <span class="text-amber-500" title="High engagement">⭐</span>
      )}
      <span class={`px-2 py-0.5 text-xs font-medium rounded-full ${sourceInfo.color}`}>
        {sourceLabel}
      </span>
      <span class="text-xs text-ink-400">
        {score} pts · {comments} comments
      </span>
    </div>
    <!-- Save indicator (shown when saved) -->
    <span class="saved-indicator hidden text-rose-500 text-sm" title="Saved">♥</span>
  </div>

  <!-- Title (clickable for analysis) -->
  <h3 class="card-title text-base font-bold text-ink-900 mb-2 line-clamp-2 cursor-pointer hover:text-accent transition-colors">
    {title}
  </h3>

  <!-- Selftext preview -->
  {truncatedText && (
    <p class="text-sm text-ink-500 mb-3 line-clamp-3">
      {truncatedText}
    </p>
  )}

  <!-- Potential badges -->
  <div class="flex items-center gap-2 mb-4 text-xs">
    <span class={`px-2 py-0.5 rounded-full ${potentialColors[fbPotential] || potentialColors.Low}`}>
      FB: {fbPotential}
    </span>
    <span class={`px-2 py-0.5 rounded-full ${potentialColors[blogPotential] || potentialColors.Low}`}>
      Blog: {blogPotential}
    </span>
    <span class="text-ink-400">
      Score: {engagementScore}/5
    </span>
  </div>

</div>

<style>
  .item-card {
    container-type: inline-size;
    border-left: 3px solid var(--color-accent, #d97706);
  }
  .item-card.is-saved .saved-indicator {
    display: inline;
  }
  /* Viewed state: remove border, gray title, slight opacity */
  .item-card.is-viewed {
    border-left-color: transparent;
    opacity: 0.65;
  }
  .item-card.is-viewed .card-title {
    font-weight: 400;
    color: var(--color-ink-500, #6b7280);
  }
  .item-card.is-viewed:hover {
    opacity: 0.9;
  }
</style>
