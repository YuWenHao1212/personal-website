---
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const thankYouUrl = `/${lang}/thank-you`;

// Newsletter content (zh-TW only — EN uses LinkedIn + Blog buttons)
const newsletter = {
  cta: '我每週寫一封信 — 聊怎麼把 AI 用在真實生活和工作裡，和一路上想通的道理。訂閱直接寄給你。',
  placeholder: '輸入你的 Email',
  button: '寄給我',
  privacy: '不會濫發垃圾郵件，隨時可以退訂。',
};

const enCta = {
  text: 'I\'m always open to interesting conversations and opportunities — connect on LinkedIn, or explore the blog.',
  linkedIn: 'Connect on LinkedIn',
  blog: 'Read the Blog',
};

// Products data (EN only — zh-TW uses compact version in index.astro)
const products = lang === 'en' ? [
  {
    name: 'NeatToolkit',
    description: 'Free online tools. Background removal, video compression, YouTube subtitle download. No signup required.',
    href: '/en/products/neatoolkit/',
    image: '/images/blog/neatoolkit-launch.webp',
    badge: 'New',
  },
  {
    name: 'AI Resume Advisor',
    description: 'AI-powered resume analysis tool that helps you craft more competitive resumes.',
    href: '/en/products/ai-resume-advisor/',
    image: '/images/products/ai-resume-advisor.webp',
    badge: 'Popular',
  },
  {
    name: 'LinkedIn Resume Checker',
    description: 'Chrome Extension that analyzes your match with LinkedIn job postings in one click.',
    href: '/en/products/linkedin-resume-checker/',
    image: '/images/products/linkedin-resume-checker.webp',
    badge: 'Popular',
  },
] : [];

---

<section>
  <!-- Hero: Integrated with Newsletter (雷蒙三十 style) -->
  <div class="min-h-[80vh] flex items-center bg-[#FAF8F5]">
    <div class="w-full max-w-6xl mx-auto px-6 py-20 md:py-28">
      <div class="grid md:grid-cols-12 gap-10 md:gap-16 items-center">
        <!-- Content - Left columns -->
        <div class="md:col-span-7 text-center md:text-left order-2 md:order-1">
          <!-- Main headline -->
          <h1 class="text-[1.75rem] sm:text-[2rem] md:text-[3rem] lg:text-[3.5rem] font-bold text-[#2C2416] leading-[1.15] tracking-[-0.02em] mb-6">
            {t('hero.tagline')}
          </h1>

          <!-- Subtext / Value proposition -->
          <p class="text-lg md:text-xl text-[#5C5144] mb-8 max-w-xl leading-[1.6]">
            {t('hero.description')}
          </p>

          {lang === 'zh-TW' ? (
            <>
              {/* Newsletter CTA - zh-TW only */}
              <p class="text-base md:text-lg text-[#2C2416] font-medium mb-6">
                {newsletter.cta}
              </p>

              {/* Newsletter Form */}
              <form
                id="hero-newsletter-form"
                class="flex flex-col sm:flex-row gap-3 max-w-lg"
                data-umami-event="newsletter_signup_hero"
                data-thank-you-url={thankYouUrl}
              >
                <input
                  type="email"
                  name="email_address"
                  placeholder={newsletter.placeholder}
                  required
                  class="flex-1 px-5 py-4 border-2 border-[#2C2416] bg-[#FFFDF9] text-[#2C2416] placeholder-[#8B7355] focus:outline-none focus:ring-0 text-base"
                />
                <button
                  type="submit"
                  class="px-8 py-4 bg-[#2C2416] text-[#FAF8F5] text-base font-medium hover:bg-[#3D3220] transition-colors whitespace-nowrap"
                >
                  {newsletter.button}
                </button>
              </form>

              <p class="mt-4 text-sm text-[#8B7355]">
                {newsletter.privacy}
              </p>
            </>
          ) : (
            <>
              {/* LinkedIn + Blog CTA - EN only */}
              <p class="text-base md:text-lg text-[#5C5144] mb-6">
                {enCta.text}
              </p>

              <div class="flex flex-col sm:flex-row gap-3 max-w-lg">
                <a
                  href="https://www.linkedin.com/in/hence/"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="px-8 py-4 bg-[#2C2416] text-[#FAF8F5] text-base font-medium hover:bg-[#3D3220] transition-colors whitespace-nowrap text-center"
                  data-umami-event="hero_linkedin_click"
                >
                  {enCta.linkedIn}
                </a>
                <a
                  href="/en/blog/"
                  class="px-8 py-4 border-2 border-[#2C2416] text-[#2C2416] text-base font-medium hover:bg-[#2C2416] hover:text-[#FAF8F5] transition-colors whitespace-nowrap text-center"
                  data-umami-event="hero_blog_click"
                >
                  {enCta.blog}
                </a>
              </div>
            </>
          )}

          <!-- Secondary CTAs -->
          <div class="flex flex-wrap gap-4 justify-center md:justify-start mt-8 pt-8 border-t border-[#E8E4DD]">
            <a
              href={`/${lang}/about/`}
              class="text-[#5C5144] hover:text-[#2C2416] text-sm font-medium transition-colors flex items-center gap-1"
            >
              {t('hero.cta.story')}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
            </a>
            <a
              href={`/${lang}/blog/`}
              class="text-[#5C5144] hover:text-[#2C2416] text-sm font-medium transition-colors flex items-center gap-1"
            >
              {t('hero.cta.posts')}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
            </a>
            <a
              href="mailto:mail@yu-wenhao.com?subject=Hello"
              class="text-[#5C5144] hover:text-[#2C2416] text-sm font-medium transition-colors flex items-center gap-1"
            >
              {t('hero.cta.chat')}
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
            </a>
          </div>
        </div>

        <!-- Photo - Right column -->
        <div class="md:col-span-5 flex justify-center order-1 md:order-2">
          <img
            src="/images/hero.webp"
            alt="WenHao Yu"
            width="400"
            height="400"
            class="w-48 h-48 md:w-64 md:h-64 lg:w-80 lg:h-80 rounded-full object-cover shadow-lg"
            loading="eager"
            fetchpriority="high"
            decoding="async"
          />
        </div>
      </div>
    </div>
  </div>

  {lang === 'en' && products.length > 0 && (
    <div class="bg-[#F5F1EB] py-24 md:py-32">
      <div class="max-w-6xl mx-auto px-6">
        <div class="mb-16 md:mb-20">
          <h2 class="text-[2rem] md:text-[2.5rem] lg:text-[3rem] font-bold text-[#2C2416] leading-[1.1] tracking-[-0.02em]">
            Products I Built
          </h2>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-10">
          {products.map((product) => (
            <a
              href={product.href}
              class="group block bg-white border border-cream-200 rounded-xl overflow-hidden cursor-pointer hover:shadow-lg hover:border-accent/30 hover:-translate-y-2 transition-all duration-300"
              data-umami-event="hero_product_click"
              data-umami-event-product={product.name}
            >
              <div class="relative overflow-hidden aspect-[16/10]">
                <img
                  src={product.image}
                  alt={product.name}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                  loading="eager"
                />
                {product.badge && (
                  <span class="absolute top-3 left-3 px-2.5 py-1 text-xs font-medium bg-accent text-white rounded-full shadow-sm">
                    {product.badge}
                  </span>
                )}
              </div>

              <div class="p-5 md:p-6">
                <h3 class="text-base md:text-lg font-semibold text-ink-900 mb-2 group-hover:text-accent transition-colors">
                  {product.name}
                </h3>
                <p class="text-xs md:text-sm text-ink-500 mb-4 leading-relaxed">
                  {product.description}
                </p>
                <span class="inline-flex items-center text-sm font-medium text-ink-900 group-hover:text-accent transition-colors">
                  Try Now
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                  </svg>
                </span>
              </div>
            </a>
          ))}
        </div>
      </div>
    </div>
  )}

  <script>
    const form = document.getElementById('hero-newsletter-form') as HTMLFormElement;

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      const thankYouUrl = form.dataset.thankYouUrl || '/zh-TW/thank-you';

      try {
        await fetch('https://app.kit.com/forms/8951335/subscriptions', {
          method: 'POST',
          body: formData,
          mode: 'no-cors'
        });

        window.location.href = thankYouUrl;
      } catch (error) {
        console.error('Newsletter subscription failed:', error);
        window.location.href = thankYouUrl;
      }
    });
  </script>
</section>
